function WAMP(e){var t;self=this;self.clientType=e;self.callbacks=e.wampMethods;self.currentOffers=[];self.myPlayer;self.offer;try{var n=require("autobahn")}catch(r){}var i,s=new n.Connection({url:"ws://capricorn.local:8080/ws",realm:"tradingpit"});s.onopen=function(e){self.sess=e;var t=null;w.wampMethods.rpcCall("signin");e.subscribe("pit.pub.offers",self.callbacks.onOffer).then(function(e){t=e},function(e){});e.subscribe("pit.pub.clock",self.callbacks.onTick).then(function(e){t=e},function(e){})};s.open()}var aiwamp=function(){this.wampMethods={test:function(){alert("I'm an AI!")},onCard:function(e,t,n){},onTick:function(e,t,n){},onOffer:function(e,t,n){},onAccept:function(e,t,n){}};this.wamp=new WAMP(this)},playerwamp=function(){this.wampMethods={test:function(){alert("I'm a Player!")},onCard:function(e,t,n){console.log("CARD",t);$(".moneyCounter").html("$"+t.surplus);$(".value").html(t.reserve);reserve=t.reserve;self.myPlayer=t},onTick:function(e,t,n){$("#time").html(t.minutes+":"+t.seconds)},onOffer:function(e,t,n){self.currentOffers=t[opponent];$.get("offer_template.html",function(e){Mustache.parse(e);var n=Mustache.render(e,t);$(".flex-offers").html(n)})},submitOffer:function(e){self.offer.owner=self.myPlayer;self.offer.price=e;console.log("self.offer= ",self.offer);w.wampMethods.rpcCall("offer")},accept:function(e){console.log("Accept Offer Request");var t=self.currentOffers[e%4];console.log("Offer: ",t,self.sess);w.wampMethods.rpcCall("accept")},rpcCall:function(e){console.log(e);e=="signin"?self.sess.call("pit.rpc.signin",[],{name:"QT",position:0,role:"buyer",id:self.sess.id,meat:"true"}).then(function(e){self.sess.subscribe(e.cardURI,self.callbacks.onCard);myShape=e.shape;$(".my-logoDiv").load("shapes.html  #"+myShape);console.log("This player: ");console.log(e);self.sess.call("pit.rpc.offerTemplate").then(function(e){self.offer=e})}):e=="offer"?self.sess.call("pit.rpc.offer",[],self.offer):e=="accept"&&self.sess.call("pit.rpc.accept",[],{bidder:self.myPlayer,offer:offer}).then(function(e){console.log("onAccept return r: ",e)},function(e){console.log("Error: ",e)})}};this.wamp=new WAMP(this)};ai?w=new aiwamp:w=new playerwamp;