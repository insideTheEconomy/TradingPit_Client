function WAMP(e){var t;self=this;self.clientType=e;self.callbacks=e.wampMethods;self.currentOffers=[];self.myPlayer;self.offer;self.acceptedOffer;var n,r=new autobahn.Connection({url:url,realm:"tradingpit"});r.onopen=function(e){self.sess=e;var t=null;self.sess.subscribe("pit.pub."+self.sess.id,self.callbacks.onCard);e.subscribe("pit.pub.offers",self.callbacks.onOffer).then(function(e){t=e},function(e){});e.subscribe("pit.pub.clock",self.callbacks.onTick).then(function(e){t=e},function(e){});e.subscribe("pit.pub.phase",self.callbacks.onPhase).then(function(e){t=e},function(e){})};r.open()}var aiwamp=function(){this.wampMethods={test:function(){alert("I'm an AI!")},onCard:function(e,t,n){},onTick:function(e,t,n){},onOffer:function(e,t,n){},onPhase:function(){},onAccept:function(e,t,n){}};this.wamp=new WAMP(this)},playerwamp=function(){this.wampMethods={test:function(){alert("I'm a Player!")},onCard:function(e,t,n){console.log("CARD",t);$(".moneyCounter").html("$"+t.surplus);$(".dollar").addClass("anim");setTimeout(function(){$(".dollar").removeClass("anim")},220);$(".value").html(t.reserve);$(".greyed").removeClass("greyed");reserve=t.reserve;self.myPlayer=t},onTick:function(e,t,n){curScreen==0?$(".idletime").html(t.minutes+":"+t.seconds):curScreen==2&&$("#time").html(t.minutes+":"+t.seconds)},onOffer:function(e,t,n){self.currentOffers=t[opponent];$.get(role+"_template.html",function(e){Mustache.parse(e);var n=Mustache.render(e,t);$(".flex-offers").html(n)})},submitOffer:function(e){self.offer.owner=self.myPlayer;self.offer.price=e;self.offer.name=name;console.log("self.offer= ",self.offer);w.wampMethods.rpcCall("offer")},accept:function(e){self.acceptedOffer=self.currentOffers[e%4];w.wampMethods.rpcCall("accept")},onPhase:function(e,t,n){if(t.action=="enter")switch(t.name){case"setup":console.log("E setup");phase=0;break;case"Round":console.log("E Round");phase=1;if(name!="null"){curScreen=2;changeScreen()}break;case"Wrap-up":console.log("E Wrap-up");phase=2;curScreen=0;changeScreen();break;case"Recap":console.log("E Recap");phase=3}else switch(t.name){case"setup":console.log("X setup");break;case"Round":console.log("X Round");break;case"Wrap-up":console.log("X Wrap-up");break;case"Recap":console.log("X Recap")}},rpcCall:function(e){if(e=="signin"){console.log(e);self.sess.call("pit.rpc.signin",[],{id:self.sess.id,player:{role:role,position:position,id:self.sess.id,meat:"true",name:name}}).then(function(e){myShape=e.shape;$(".my-logoDiv").load("shapes.html  #"+myShape);self.sess.call("pit.rpc.offerTemplate").then(function(e){self.offer=e})})}else if(e=="offer")self.sess.call("pit.rpc.offer",[],{id:self.sess.id,offer:self.offer});else if(e=="accept"){console.log("RPC CALL self.acceptedOffer= ",self.acceptedOffer);self.sess.call("pit.rpc.accept",[],{id:self.sess.id,offer:self.acceptedOffer}).then(function(e){console.log("onAccept return r: ",e)},function(e){console.log("Error: ",e)})}}};this.wamp=new WAMP(this)};ai?w=new aiwamp:w=new playerwamp;